# ğŸ¤– LINE Chatbot à¸”à¹‰à¸§à¸¢ n8n + Google Gemini

Workflow à¸™à¸µà¹‰à¸ªà¸£à¹‰à¸²à¸‡ **AI Chatbot à¸šà¸™ LINE** à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰ **n8n** à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š **Google Gemini** (à¸œà¹ˆà¸²à¸™ LangChain Agent)  
à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸šà¸­à¸—à¸ªà¸²à¸¡à¸²à¸£à¸–à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸›à¹‡à¸™à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´à¹à¸¥à¸°à¸ªà¸¸à¸ à¸²à¸ ğŸ’¬âœ¨

---

ğŸ¥ à¸§à¸´à¸”à¸µà¹‚à¸­à¸ªà¸­à¸™:  
[![Watch the video](https://github.com/novelbiz/AI_Automation/blob/main/assets/thumbnail/line%20chat%20bot.png)](https://youtu.be/0N3X9lG6n2c?si=bxz-EYSnoLIo2lJL)

---

## ğŸ§© à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸”à¸¢à¸£à¸§à¸¡à¸‚à¸­à¸‡ Workflow

### ğŸ”— 1. Webhook (Trigger)
- **Node:** `Webhook`
- **Type:** `n8n-nodes-base.webhook`
- **Method:** `POST`
- **Path:** `8ca874e4-80b3-403d-875a-7065ebfda19f`
- **à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ:**  
  à¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ LINE Messaging API à¹€à¸¡à¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹€à¸‚à¹‰à¸²à¸¡à¸²

---

### ğŸ§± 2. Edit Fields (Set)
- **Node:** `Edit Fields`
- **Type:** `n8n-nodes-base.set`
- **à¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ:**  
  à¸”à¸¶à¸‡à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸à¸ˆà¸²à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡ LINE à¹„à¸”à¹‰à¹à¸à¹ˆ  
  - `body.events[0].message.text` â†’ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¹ˆà¸‡à¸¡à¸²  
  - `body.events[0].replyToken` â†’ token à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰  

```js
{
  "body.events[0].message.text": "={{ $json.body.events[0].message.text }}",
  "body.events[0].replyToken": "={{ $json.body.events[0].replyToken }}"
}
```

---

### ğŸ§  3. AI Agent (LangChain Agent)
- **Node:** `AI Agent`
- **Type:** `@n8n/n8n-nodes-langchain.agent`
- **à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ:**  
  à¹ƒà¸Šà¹‰ **Google Gemini** à¹€à¸›à¹‡à¸™à¹‚à¸¡à¹€à¸”à¸¥à¸ à¸²à¸©à¸²à¸«à¸¥à¸±à¸ (Language Model) à¹€à¸à¸·à¹ˆà¸­à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¸­à¸šà¸à¸¥à¸±à¸š  
  à¸à¸£à¹‰à¸­à¸¡à¸£à¸°à¸šà¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ (System Message) à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”à¹à¸™à¸§à¸—à¸²à¸‡à¸à¸²à¸£à¸à¸¹à¸” à¹€à¸Šà¹ˆà¸™  
  - à¸ªà¸¸à¸ à¸²à¸ à¹€à¸›à¹‡à¸™à¸à¸±à¸™à¹€à¸­à¸‡  
  - à¹ƒà¸Šà¹‰à¸ à¸²à¸©à¸²à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´  
  - à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸ªà¹ˆà¸­à¸µà¹‚à¸¡à¸ˆà¸´à¹„à¸”à¹‰  
  - à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸­à¸±à¸à¸‚à¸£à¸°à¸à¸´à¹€à¸¨à¸© à¹€à¸Šà¹ˆà¸™ `\n`, `\r`, `\`  

**Prompt à¸—à¸µà¹ˆà¸ªà¹ˆà¸‡à¹ƒà¸«à¹‰à¹‚à¸¡à¹€à¸”à¸¥:**
```text
à¸™à¸µà¹ˆà¸„à¸·à¸­à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¹ˆà¸‡à¸¡à¸²à¹ƒà¸™ LINE: "{{ $json.body.events[0].message.text }}"
à¹‚à¸›à¸£à¸”à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸”à¹‰à¸§à¸¢à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¸ªà¸¸à¸ à¸²à¸ à¹€à¸›à¹‡à¸™à¸à¸±à¸™à¹€à¸­à¸‡ à¹à¸¥à¸°à¸­à¹ˆà¸²à¸™à¸‡à¹ˆà¸²à¸¢
à¹ƒà¸Šà¹‰à¸ à¸²à¸©à¸²à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´ à¹à¸¥à¸°à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸ªà¹ˆà¸­à¸µà¹‚à¸¡à¸ˆà¸´à¹„à¸”à¹‰à¸–à¹‰à¸²à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡
à¸•à¸­à¸šà¹ƒà¸«à¹‰à¸•à¸£à¸‡à¸›à¸£à¸°à¹€à¸”à¹‡à¸™ à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸‡à¹ˆà¸²à¸¢ à¹à¸¥à¸°à¹€à¸›à¹‡à¸™à¸¡à¸´à¸•à¸£
```

---

### ğŸŒ 4. Google Gemini Chat Model
- **Node:** `Google Gemini Chat Model`
- **Type:** `@n8n/n8n-nodes-langchain.lmChatGoogleGemini`
- **Credentials:** `Google Gemini(PaLM) Api account`
- **à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ:**  
  à¹€à¸›à¹‡à¸™à¹‚à¸¡à¹€à¸”à¸¥à¸ à¸²à¸©à¸² (LLM) à¸—à¸µà¹ˆà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š Agent à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰ AI à¸ªà¸²à¸¡à¸²à¸£à¸–à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¹„à¸”à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¸Šà¸²à¸à¸‰à¸¥à¸²à¸”

---

### ğŸ§® 5. Code (Clean JSON)
- **Node:** `Code`
- **Type:** `n8n-nodes-base.code`
- **à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ:**  
  à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸ˆà¸²à¸ AI à¸à¹ˆà¸­à¸™à¸ˆà¸°à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸šà¹„à¸›à¸¢à¸±à¸‡ LINE  
  à¹‚à¸”à¸¢à¸¥à¸šà¸­à¸±à¸à¸‚à¸£à¸° `\n`, `\r`, `/` à¹à¸¥à¸°à¸”à¸¶à¸‡à¹€à¸‰à¸à¸²à¸°à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™ JSON à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¹‚à¸„à¹‰à¸”à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰:**
```js
let rawData = $input.first().json.output ?? $input.first().json;

if (typeof rawData !== 'string') {
  rawData = JSON.stringify(rawData);
}

rawData = rawData.replace(/\r?\n|\r/g, '').replace(/\//g, '');

const match = rawData.match(/\{[\s\S]*\}/);

if (match) {
  try {
    const cleanJson = JSON.parse(match[0]);
    return [{ json: cleanJson }];
  } catch (err) {
    return [{ json: { error: 'Invalid JSON after cleaning', raw: match[0] } }];
  }
} else {
  return [{ json: { error: 'No JSON found in input', raw: rawData } }];
}
```

---

### ğŸ’¾ 6. Simple Memory
- **Node:** `Simple Memory`
- **Type:** `@n8n/n8n-nodes-langchain.memoryBufferWindow`
- **à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ:**  
  à¹€à¸à¹‡à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸ªà¸™à¸—à¸™à¸²à¹à¸šà¸šà¸‡à¹ˆà¸²à¸¢ (Memory Buffer)  
  à¹‚à¸”à¸¢à¸ªà¸£à¹‰à¸²à¸‡ Session Key à¹à¸šà¸šà¸ªà¸¸à¹ˆà¸¡à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸•à¹ˆà¸¥à¸°à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰

---

### ğŸ’¬ 7. Reply to LINE (HTTP Request)
- **Node:** `reply to line`
- **Type:** `n8n-nodes-base.httpRequest`
- **Method:** `POST`
- **URL:** `https://api.line.me/v2/bot/message/reply`
- **Headers:**
  ```json
  {
    "Content-Type": "application/json",
    "Authorization": "Bearer [LINE_CHANNEL_ACCESS_TOKEN]"
  }
  ```
- **Body:**
  ```json
  {
    "replyToken": "{{ $('Edit Fields').item.json.body.events[0].replyToken }}",
    "messages": [
      {
        "type": "text",
        "text": "{{ $json.raw }}"
      }
    ]
  }
  ```

---

## ğŸ”„ à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ Node

| à¸ˆà¸²à¸ | à¹„à¸›à¸¢à¸±à¸‡ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|-----|--------|-------------|
| Webhook | Edit Fields | à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸ LINE |
| Edit Fields | AI Agent | à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹„à¸›à¹ƒà¸«à¹‰ AI à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥ |
| Google Gemini Chat Model | AI Agent | à¹ƒà¸Šà¹‰à¹‚à¸¡à¹€à¸”à¸¥ Gemini à¹€à¸›à¹‡à¸™ LLM |
| Simple Memory | AI Agent | à¸ˆà¸±à¸”à¸à¸²à¸£ memory à¸à¸²à¸£à¸ªà¸™à¸—à¸™à¸² |
| AI Agent | Code | à¸ªà¹ˆà¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸«à¹‰à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸” |
| Code | reply to line | à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸à¸¥à¸±à¸šà¹„à¸›à¸—à¸µà¹ˆ LINE |

---

## ğŸš€ à¸§à¸´à¸˜à¸µà¹ƒà¸Šà¹‰à¸‡à¸²à¸™

1. à¸ªà¸£à¹‰à¸²à¸‡ Workflow à¹ƒà¸™à¸™8n à¹à¸¥à¹‰à¸§à¸™à¸³ JSON à¸”à¹‰à¸²à¸™à¸šà¸™à¹„à¸› Import  
2. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Credential à¸ªà¸³à¸«à¸£à¸±à¸š
   - **Google Gemini (PaLM API)**
   - **LINE Channel Access Token**
3. Deploy Workflow à¹ƒà¸«à¹‰à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™  
4. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Webhook URL à¹„à¸›à¸—à¸µà¹ˆ **LINE Developer Console** (Messaging API â†’ Webhook URL)  
5. à¸—à¸”à¸ªà¸­à¸šà¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸ LINE à¹à¸¥à¹‰à¸§à¸£à¸­à¸”à¸¹à¸„à¸³à¸•à¸­à¸šà¸ˆà¸²à¸ AI ğŸ¤–ğŸ’¬

---

## ğŸ§  à¸ªà¸£à¸¸à¸›
Workflow à¸™à¸µà¹‰à¸ˆà¸°à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¸„à¸¸à¸“à¸ªà¸£à¹‰à¸²à¸‡ **LINE Chatbot** à¸—à¸µà¹ˆà¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸”à¹‰à¸§à¸¢ **AI Google Gemini**  
à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰ **n8n** à¹€à¸›à¹‡à¸™ Workflow Automation à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸„à¹‰à¸”à¸¡à¸²à¸ ğŸ”§  
à¸ªà¸²à¸¡à¸²à¸£à¸–à¸›à¸£à¸±à¸šà¹à¸•à¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¸­à¸šà¸à¸¥à¸±à¸š à¸ªà¹„à¸•à¸¥à¹Œà¸à¸²à¸£à¸à¸¹à¸” à¸«à¸£à¸·à¸­à¹€à¸à¸´à¹ˆà¸¡ Node à¸­à¸·à¹ˆà¸™ à¹† à¹€à¸Šà¹ˆà¸™ Google Sheet, Database, API à¸•à¹ˆà¸²à¸‡ à¹† à¹„à¸”à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¸­à¸´à¸ªà¸£à¸° ğŸ¯  

---

> âœ¨ **à¸à¸±à¸’à¸™à¸²à¹‚à¸”à¸¢:** à¸£à¸°à¸šà¸šà¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ n8n  
> ğŸ¤ **à¸œà¸ªà¸²à¸™à¸à¸¥à¸±à¸‡:** LINE Messaging API + Google Gemini (LangChain)
